(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{224:function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"fetchUser",(function(){return g})),r.d(n,"submitSurvey",(function(){return y}));r(95);var c=r(0),s=r(39),a=r.n(s),i=r(20),l=r(22),o=r(89),u=r(17),j=r(5),b=r(41),d=r(90),h=r(27),O=r(2),x=r.n(O),f=r(6),v=r(10),p=r.n(v),m="fetch_user";console.log({FETCH_USER:m});var g=function(){return function(){var e=Object(f.a)(x.a.mark((function e(t){var r,n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.get("/api/users/current-user");case 2:r=e.sent,n=r.data,t({type:m,payload:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},y=function(e,t,r){return function(){var n=Object(f.a)(x.a.mark((function n(c){var s,a;return x.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,p.a.post("/api/surveys",Object(h.a)(Object(h.a)({},e),{},{cancelToken:t}));case 3:s=n.sent,a=s.data,c({type:m,payload:a}),r(!0),n.next=13;break;case 9:throw n.prev=9,n.t0=n.catch(0),console.dir(n.t0),n.t0;case 13:case"end":return n.stop()}}),n,null,[[0,9]])})));return function(e){return n.apply(this,arguments)}}()},N=r(1),w=function(){var e=Object(b.useStripe)(),t=function(){var t=Object(f.a)(x.a.mark((function t(r){var n,c;return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.a.get("/api/billings/get-checkout-session");case 2:return n=t.sent,c=n.data,t.next=6,e.redirectToCheckout({sessionId:c.id});case 6:t.sent.error;case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(N.jsx)("button",{role:"link",onClick:t,className:"btn",children:"Add credits"})};var S=Object(i.b)((function(e){return{auth:e.auth}}))((function(e){return Object(N.jsx)("nav",{children:Object(N.jsx)("div",{className:"nav-wrapper",children:Object(N.jsxs)("div",{className:"col s12",children:[Object(N.jsx)(u.b,{className:"brand-logo left",to:e.auth?"/surveys":"/",children:"Emaily"}),Object(N.jsx)("ul",{className:"right",children:function(){switch(e.auth){case null:return;case!1:return Object(N.jsx)("li",{children:Object(N.jsx)("a",{href:"/auth/google",children:"Login with Google"})});default:return Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)("li",{children:Object(N.jsx)(w,{})}),Object(N.jsxs)("li",{style:{margin:"0 10px"},children:["Credits: ",e.auth.credits]}),Object(N.jsx)("li",{children:Object(N.jsx)("a",{href:"/auth/logout",children:"Logout"})})]})}}()})]})})})})),k=function(){return Object(N.jsxs)("div",{style:{textAlign:"center"},children:[Object(N.jsx)("h1",{children:"Emaily!"}),Object(N.jsx)("p",{children:"Collect feed back from your users"})]})},E=r(7),T=Object(c.createContext)(),C=function(){var e=Object(c.useContext)(T);if(void 0===e)throw new Error("useSurveysState must be used within a SurveysProvider");return e},D=function(e){var t=e.children,r=Object(c.useState)(),n=Object(E.a)(r,2),s=n[0],a=n[1],i=p.a.CancelToken.source();return Object(c.useEffect)((function(){return function(){var e=Object(f.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.a.get("/api/surveys",{cancelToken:i.token});case 3:t=e.sent,a(t.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),p.a.isCancel(e.t0)?console.log("Request canceled",e.t0.message):console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}()(),function(){i.cancel("Operation cancled by the user")}}),[]),Object(N.jsx)(T.Provider,{value:{surveys:s},children:t})},R=function(){var e=C().surveys;return console.log(e),Object(N.jsx)("div",{children:e&&e.map((function(e){var t=e._id,r=e.title,n=(e.subject,e.body),c=e.yes,s=e.no,a=e.dateSent;return Object(N.jsxs)("div",{class:"card blue-grey darken-1",children:[Object(N.jsxs)("div",{class:"card-content white-text",children:[Object(N.jsx)("span",{class:"card-title",children:r}),Object(N.jsx)("p",{children:n}),Object(N.jsxs)("p",{className:"right ita",children:["Sent on:"," ",(a?new Date(a):new Date).toLocaleDateString()]})]}),Object(N.jsxs)("div",{class:"card-action",children:[Object(N.jsxs)("a",{children:["YES: ",c]}),Object(N.jsxs)("a",{children:["NO: ",s]})]})]},t)}))})},I=function(){var e=C().surveys;return Object(N.jsxs)("div",{children:[Object(N.jsx)(R,{surveys:e}),Object(N.jsx)("div",{className:"fixed-action-btn",children:Object(N.jsx)(u.b,{to:"/surveys/new/",className:"btn-floating btn-large red",children:Object(N.jsx)("i",{className:"large material-icons",children:"add"})})})]})},P=Object(c.createContext)(),A=function(){var e=Object(c.useContext)(P);if(void 0===e)throw new Error("useSurveyFormState must be used within a SurveyFormProvider");return e},L=function(e){var t=e.children,r=Object(c.useState)({}),n=Object(E.a)(r,2),s=n[0],a=n[1],i=Object(c.useReducer)((function(e){return!e}),!1),l=Object(E.a)(i,2),o=l[0],u=l[1];return Object(N.jsx)(P.Provider,{value:{isOn:o,toggleIsON:u,surveyData:s,setSurveyData:a},children:t})},_=r(42),q=r(94),F=r(24),V=function(e){var t=e.inputName,r=e.labelName,n=e.register,c=e.error,s=r.trim().toLowerCase().split(" ").join("-"),a=A().surveyData;return console.log(a),Object(N.jsxs)("div",{style:{marginBottom:"10px"},children:[Object(N.jsx)("label",{for:s,children:r}),Object(N.jsx)("input",{id:s,name:t,type:"text",ref:n,defaultValue:a[t]}),c&&Object(N.jsx)("span",{className:"red-text","data-error":"right","data-success":"wrong",role:"alert",children:Array.isArray(c)?c.reduce((function(e,t){return t?e?"".concat(e,", ").concat(t.message):t.message:e}),""):c.message})]})},Z=[{labelName:"Survey title",inputName:"title"},{labelName:"Subject line",inputName:"subject"},{labelName:"Email body",inputName:"body"},{labelName:"Recipient list",inputName:"recipients"}],B=F.b().shape({title:F.c().required().trim(),subject:F.c().required().trim(),body:F.c().required().trim(),recipients:F.a().transform((function(e,t){return this.isType(e)&&null!==e?e:t?t.split(/[\s,]+/):[]})).min(1).of(F.c().trim().email((function(e){var t=e.value;return"".concat(t," is not a valid email")})))}),M=function(){var e=Object(_.b)({mode:"all",resolver:Object(q.yupResolver)(B)}),t=e.register,r=e.handleSubmit,n=e.formState,s=A(),a=s.surveyData,i=s.setSurveyData,l=s.toggleIsON;console.log({surveyData:a,setSurveyData:i});return console.log("--RENDER"),Object(c.useEffect)((function(){console.log("-- Touched",n.touched),console.log("-- Errors",n.errors),console.log("-- Is valid",n.isValid),console.log("-- Is Dirty",n.isDirty)}),[n]),Object(N.jsxs)("form",{onSubmit:r((function(e){i(e),l()})),children:[Z.map((function(e){return Object(N.jsx)(V,Object(h.a)(Object(h.a)({},e),{},{error:n.errors[e.inputName],register:t}))})),Object(N.jsx)(u.b,{to:"/surveys",className:"btn-flat red white-text left",children:"Cancel"}),Object(N.jsxs)("button",{type:"submit",disabled:!n.isValid,className:"btn-flat teal white-text right",children:["Next",Object(N.jsx)("i",{className:"material-icons right",children:"navigate_next"})]})]})},U=Object(i.b)(null,n)((function(e){var t=A(),r=t.toggleIsON,n=t.surveyData,s=Object(c.useState)(!1),a=Object(E.a)(s,2),i=a[0],l=a[1],o=p.a.CancelToken.source(),u=function(){var t=Object(f.a)(x.a.mark((function t(){return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.submitSurvey(n,o.token,l);case 3:l(!0),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.log(t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(){return t.apply(this,arguments)}}();return Object(c.useEffect)((function(){return function(){console.log("cancel token"),o.cancel()}}),[]),i?Object(N.jsx)(j.a,{to:"/surveys"}):Object(N.jsxs)("div",{children:[Object(N.jsx)("h5",{children:"Please confirm your entries"}),Z.map((function(e){var t=e.labelName,r=e.inputName,c=n[r];return Object(N.jsxs)("div",{children:[Object(N.jsx)("label",{children:t}),Object(N.jsx)("div",{children:Array.isArray(c)&&c.length>1?c.join(", "):c})]})})),Object(N.jsxs)("button",{className:"btn-flat yellow dark-text left",onClick:function(){return r()},children:[Object(N.jsx)("i",{className:"material-icons left",children:"navigate_before"}),"BACK"]}),Object(N.jsxs)("button",{className:"btn-flat teal white-text right",onClick:u,children:["Send",Object(N.jsx)("i",{className:"material-icons right",children:"send"})]})]})})),z=function(){var e=A().isOn;return Object(N.jsx)("div",{children:e?Object(N.jsx)(U,{}):Object(N.jsx)(M,{})})},J=Object(d.a)("pk_test_51IMbKDARwTjeOxT1lPRBtMagFQ7hVg4IOTfYv6ZWU8qiT2l6MdqfcrNOzLGQtpZxFbB7LblZVR7S3P6cnZzETiLJ00AuiP4fOW"),K=Object(i.b)(null,n)((function(e){return Object(c.useEffect)((function(){e.fetchUser()}),[e]),Object(N.jsx)(b.Elements,{stripe:J,children:Object(N.jsx)("div",{className:"container",children:Object(N.jsx)("div",{className:"row",children:Object(N.jsx)(u.a,{children:Object(N.jsxs)("div",{children:[Object(N.jsx)(S,{}),Object(N.jsxs)(j.d,{children:[Object(N.jsx)(j.b,{path:"/surveys/new",children:Object(N.jsx)(L,{children:Object(N.jsx)(z,{})})}),Object(N.jsx)(j.b,{path:"/surveys",children:Object(N.jsx)(D,{children:Object(N.jsx)(I,{})})}),Object(N.jsx)(j.b,{path:"/",children:Object(N.jsx)(k,{})})]})]})})})})})}));var Q=Object(l.c)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m:return t.payload||!1;default:return e}}});window.axios=p.a;var W=Object(l.d)(Q,{},Object(l.a)(o.a));a.a.render(Object(N.jsx)(i.a,{store:W,children:Object(N.jsx)(K,{})}),document.getElementById("root")),console.log("STRIPE KEY IS: ","pk_test_51IMbKDARwTjeOxT1lPRBtMagFQ7hVg4IOTfYv6ZWU8qiT2l6MdqfcrNOzLGQtpZxFbB7LblZVR7S3P6cnZzETiLJ00AuiP4fOW"),console.log("ENV: ","production")}},[[224,1,2]]]);
//# sourceMappingURL=main.2d215c4a.chunk.js.map